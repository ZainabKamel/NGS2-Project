## Install [bioconda](https://docs.conda.io/en/latest/miniconda.html) if you don't have it already

```
wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh
## restart the terminal
conda config --add channels r
conda config --add channels conda-forge
conda config --add channels bioconda
```

## create a new enviornment
```
conda create -y --name ngs2 python=3.6
conda activate ngs2
```

## Data preparation 
```
### Download
mkdir -p ~/Desktop/PROJECT/SAMPLE_DATA && cd ~/Desktop/PROJECT/SAMPLE_DATA
# Control Data
wget https://sra-download.ncbi.nlm.nih.gov/traces/sra46/SRZ/010958/SRR10958001/hs_T47D_shCTRL_RNAseq_rep1.fastq.gz
wget https://sra-download.ncbi.nlm.nih.gov/traces/sra43/SRZ/010958/SRR10958009/hs_T47D_shCTRL_RNAseq_rep2.fastq.gz

# Sample Data 
wget https://sra-download.ncbi.nlm.nih.gov/traces/sra54/SRZ/010958/SRR10958000/hs_T47D_shNR2F2_RNAseq_rep1.fastq.gz
wget https://sra-download.ncbi.nlm.nih.gov/traces/sra43/SRZ/010958/SRR10958005/hs_T47D_shNR2F2_RNAseq_rep2.fastq.gz

# Reference file
wget ftp://ftp.ensembl.org/pub/release-99/fasta/homo_sapiens/dna/Homo_sapiens.GRCh38.dna.chromosome.6.fa.gz

# Annotation file
ftp://ftp.ensembl.org/pub/release-99/gff3/homo_sapiens/Homo_sapiens.GRCh38.99.chromosome.6.gff3.gz

```

## Fastq Quality Check 
```
```
# Installing Software 
conda install -c bioconda fastqc 
conda install -c bioconda multiqc 
```
mkdir -p ~/project2/fastaQC && cd ~/project2/fastaQC/
# Run the FASTQC for each read end
for f in ~/project2/sample_data/*.fastq.gz;do fastqc -t 1 -f fastq -noextract $f;done
# Merge the output reports into one super report
mv ../sample_data/*html ./
mv ../sample_data/*zip ./
multiqc -z -o . .
```
#Data Trimming 
f1="$HOME/project2/sample_data/hs_T47D_shNR2F2_RNAseq_rep1.fastq.gz"
f2="$HOME/project2/sample_data/hs_T47D_shNR2F2_RNAseq_rep2.fastq.gz"
f3="$HOME/project2/sample_data/hs_T47D_shCTRL_RNAseq_rep1.fastq.gz"
f4="$HOME/project2/sample_data/hs_T47D_shCTRL_RNAseq_rep2.fastq.gz"
newf1="$HOME/project2/sample_data/hs_T47D_shNR2F2_RNAseq_rep1.trim.fastq.gz"
newf2="$HOME/project2/sample_data/hs_T47D_shNR2F2_RNAseq_rep2.trim.fastq.gz"
newf3="$HOME/project2/sample_data/hs_T47D_shCTRL_RNAseq_rep1.trim.fastq.gz"
newf4="$HOME/project2/sample_data/hs_T47D_shCTRL_RNAseq_rep2.trim.fastq.gz"
newf1U="$HOME/project2/sample_data/hs_T47D_shNR2F2_RNAseq_rep1.trimU.fastq.gz"
newf2U="$HOME/project2/sample_data/hs_T47D_shNR2F2_RNAseq_rep2.trimU.fastq.gz"
newf3U="$HOME/project2/sample_data/hs_T47D_shCTRL_RNAseq_rep1.trimU.fastq.gz"
newf4U="$HOME/project2/sample_data/hs_T47D_shCTRL_RNAseq_rep2.trimU.fastq.gz"
trimmomatic PE -threads 1 -phred33 -trimlog trimLogFile -summary statsSummaryFile  $f1 $f2 $f3 $f4 $newf1 $newf1U $newf2 $newf2U $newf3 $newf3U $newf4 $newf4U \
ILLUMINACLIP:$adap/TruSeq3-PE.fa:2:30:10:1 SLIDINGWINDOW:4:15 MINLEN:36


#Preparation of GTF file
#first we used genometools for conversion of gff to gtf #but unfortunately it showed at GTF2.2 version which only has transcript and exon ids
gt gff3_to_gtf Homo_sapiens.GRCh38.99.chromosome.6.gff > Homo_sapiens.GRCh38.99.chromosome.6.gtf 
#so we switched to using 
gffread Homo_sapiens.GRCh38.99.chromosome.6.gff3 -T -o Homo_sapiens.GRCh38.99.chromosome.6.gtf

# INDEXING
mkdir -p ~/PROJECT/Hisat/hisat_align/hisatIndex && cd ~/PROJECT/Hisat/hisat_align/hisatIndex
ln -s ~/Desktop/PROJECT/SAMPLE_DATA/Homo_sapiens.GRCh38.dna.chromosome.6.fa .
hisat2_extract_splice_sites.py ~/Desktop/PROJECT/SAMPLE_DATA/Homo_sapiens.GRCh38.99.chromosome.6.gtf > splicesites.tsv
hisat2_extract_exons.py ~/Desktop/PROJECT/SAMPLE_DATA/Homo_sapiens.GRCh38.99.chromosome.6.gtf > exons.tsv
hisat2-build -p 1 --ss splicesites.tsv --exon exons.tsv Homo_sapiens.GRCh38.dna.chromosome.6.fa Homo_sapiens.GRCh38

# ALIGNMENT
cd ~/Desktop/PROJECT/Hisat/hisat_align/
newfile="~/Desktop/PROJECT/SAMPLE_DATA/hs_T47D_shNR2F2_RNAseq_rep1.fastq.gz"
hisat2 -p 1 -x hisatIndex/Homo_sapiens.GRCh38 --dta --rna-strandness F -U $newfile -S hs_T47D_shNR2F2_RNAseq_rep1.sam

newfile1="~/Desktop/PROJECT/SAMPLE_DATA/hs_T47D_shNR2F2_RNAseq_rep2.fastq.gz"
hisat2 -p 1 -x hisatIndex/Homo_sapiens.GRCh38 --dta --rna-strandness F -U $newfile1 -S hs_T47D_shNR2F2_RNAseq_rep2.sam

newfile2="~/Desktop/PROJECT/SAMPLE_DATA/hs_T47D_shCTRL_RNAseq_rep1.fastq.gz"
hisat2 -p 1 -x hisatIndex/Homo_sapiens.GRCh38 --dta --rna-strandness F -U $newfile2 -S hs_T47D_shCTRL_RNAseq_rep1.sam

newfile3="~/Desktop/PROJECT/SAMPLE_DATA/hs_T47D_shCTRL_RNAseq_rep2.fastq.gz"
hisat2 -p 1 -x hisatIndex/Homo_sapiens.GRCh38 --dta --rna-strandness F -U $newfile3 -S hs_T47D_shCTRL_RNAseq_rep2.sam

# Preparing SAM/BAM/SORTED_BAM files
#convert SAM file to BAM file
samtools view -bS hs_T47D_shCTRL_RNAseq_rep1.sam > hs_T47D_shCTRL_RNAseq_rep1.bam
samtools view -bS hs_T47D_shCTRL_RNAseq_rep2.sam > hs_T47D_shCTRL_RNAseq_rep2.bam
samtools view -bS hs_T47D_shNR2F2_RNAseq_rep1.sam > hs_T47D_shNR2F2_RNAseq_rep1.bam
samtools view -bS hs_T47D_shNR2F2_RNAseq_rep2.sam > hs_T47D_shNR2F2_RNAseq_rep2.bam

#convert the BAM file to a sorted BAM file
samtools sort hs_T47D_shCTRL_RNAseq_rep1.bam -o hs_T47D_shCTRL_RNAseq_rep1.sorted.bam
samtools sort hs_T47D_shCTRL_RNAseq_rep2.bam -o hs_T47D_shCTRL_RNAseq_rep2.sorted.bam
samtools sort  hs_T47D_shNR2F2_RNAseq_rep1.bam -o hs_T47D_shNR2F2_RNAseq_rep1.sorted.bam
samtools sort  hs_T47D_shNR2F2_RNAseq_rep2.bam -o hs_T47D_shNR2F2_RNAseq_rep2.sorted.bam

Differential Expression
# Quantification
GTF=/home/zainabkamel/Desktop/PROJECT/SAMPLE_DATA/Homo_sapiens.GRCh38.99.chromosome.6.gtf
featureCounts -a $GTF -g gene_id -o counts.txt  hs_T47D_shCTRL_RNAseq_rep*.bam  hs_T47D_shNR2F2_RNAseq_rep*.bam
cat counts.txt | cut -f 1,7-12 > simple_counts.txt

## Analyze the counts with Deseq
cat simple_counts.txt | Rscript deseq1.r 3x3 > results_deseq1.tsv

#View only rows with pval < 0.05

cat results_deseq1.tsv | awk ' $8 < 0.05 { print $0 }' > filtered_results_deseq1.tsv
cat filtered_results_deseq1.tsv | Rscript draw-heatmap.r > hisat_output.pdf



